import{a as j,b as $}from"./chunk-K2HBSNIS.js";import{a as q,c as U,d as H}from"./chunk-EAHOORUK.js";import{$ as p,$a as P,Ab as N,Da as M,Ga as S,Ia as B,Pa as u,Qa as s,Ra as a,Sa as C,Ta as D,Ua as f,Va as g,Za as I,_ as h,_a as L,ab as F,bb as _,cb as o,db as b,eb as v,fb as k,hb as R,ib as T,ka as W,l as G,va as l,wb as Q,xb as Y,yb as V,za as O,zb as X}from"./chunk-XSCUIATP.js";var ie=["demoCanvas"];function ne(d,e){if(d&1&&C(0,"div",27),d&2){let t=e.index,i=g(2);u("ngClass",t===i.currentPageIndex?"bg-blue-600":"bg-gray-300")}}function ae(d,e){if(d&1&&(s(0,"li",30)(1,"span",31),o(2,"\u2022"),a(),o(3),a()),d&2){let t=e.$implicit;l(3),v(" ",t," ")}}function se(d,e){if(d&1&&(s(0,"ul",28),S(1,ae,4,1,"li",29),a()),d&2){let t=g(2);l(),u("ngForOf",t.currentPage.bulletPoints)}}function re(d,e){if(d&1){let t=D();s(0,"div",2),f("click",function(n){h(t);let r=g();return p(r.onBackdropClick(n))}),s(1,"div",3),f("click",function(n){return h(t),p(n.stopPropagation())}),s(2,"div",4)(3,"div",5)(4,"div")(5,"h2",6),o(6,"Traffic Master: AI vs Traditional Control"),a(),s(7,"p",7),o(8,"Interactive Traffic Signal Optimization Experiment"),a()(),s(9,"button",8),f("click",function(){h(t);let n=g();return p(n.close())}),o(10," \xD7 "),a()()(),s(11,"div",9)(12,"div",10)(13,"div",11),S(14,ne,1,1,"div",12),a(),s(15,"span",13),o(16),a()()(),s(17,"div",14)(18,"div",15)(19,"div")(20,"h3",16),o(21),a(),s(22,"p",17),o(23),a(),S(24,se,2,1,"ul",18),a(),s(25,"div",19)(26,"app-button",20),f("click",function(){h(t);let n=g();return p(n.previousPage())}),o(27," Previous "),a(),s(28,"div",11)(29,"app-button",21),f("click",function(){h(t);let n=g();return p(n.close())}),o(30," Skip Tutorial "),a(),s(31,"app-button",22),f("click",function(){h(t);let n=g();return p(n.isLastPage?n.close():n.nextPage())}),o(32),a()()()(),s(33,"div",23)(34,"div",24),C(35,"canvas",25,0),s(37,"div",26),o(38),a()()()()()()}if(d&2){let t=g();l(14),u("ngForOf",t.pages),l(2),k(" ",t.currentPageIndex+1," of ",t.pages.length," "),l(5),v(" ",t.currentPage.title," "),l(2),v(" ",t.currentPage.description," "),l(),u("ngIf",t.currentPage.bulletPoints),l(2),u("disabled",t.currentPageIndex===0),l(5),u("variant",t.isLastPage?"primary":"secondary"),l(),v(" ",t.isLastPage?"Start Simulation":"Next"," "),l(6),v(" ",t.getVisualizationLabel()," ")}}var z=class d{canvasRef;isOpen=!1;closeModal=new B;currentPageIndex=0;ctx=null;animationId=null;demoState={phase:0,queues:[2,1.5,2.5,1.8],time:0,initialized:!1};pages=[{title:"Welcome to Traffic Master",description:"This is an interactive experiment comparing AI-powered traffic signal control with traditional fixed-timer systems. You'll see how different approaches handle real-time traffic optimization at a 4-way intersection.",bulletPoints:["Compare Reinforcement Learning (RL) vs Fixed-Timer Control","Observe real-time traffic flow and queue management","Adjust parameters to see how they affect performance","View live metrics and performance comparisons"],visualization:"overview"},{title:"Reinforcement Learning Agent (RL)",description:"The RL agent uses Deep Q-Network (DQN) to learn optimal traffic signal timing. It observes queue lengths and makes intelligent decisions to minimize total waiting time.",bulletPoints:["Learns from experience and adapts to traffic patterns","Makes decisions based on current queue lengths","Optimizes for minimal total vehicle waiting time","Gets better over time through trial and error"],visualization:"rl-demo"},{title:"Fixed-Timer Baseline",description:"The traditional approach uses predetermined timing cycles. Signals change every 30 seconds regardless of actual traffic conditions - this is how most real traffic lights work today.",bulletPoints:["Simple 30-second cycles for each direction","No adaptation to current traffic conditions","Predictable but potentially inefficient","Standard approach used in most cities worldwide"],visualization:"baseline-demo"},{title:"Interactive Controls & Metrics",description:"Use the control panel to start either system, adjust traffic arrival rates, and monitor performance. Watch how different parameters affect queue lengths and total rewards.",bulletPoints:["Start/Stop RL and Baseline simulations independently","Adjust arrival rates for each direction (North, East, South, West)","Tune RL parameters like learning rate and exploration","Compare real-time metrics: rewards, queue lengths, wait times"],visualization:"comparison"}];get currentPage(){return this.pages[this.currentPageIndex]}get isLastPage(){return this.currentPageIndex===this.pages.length-1}ngOnInit(){this.resetDemoState()}ngAfterViewInit(){this.initializeCanvas()}ngOnChanges(e){e.isOpen?.currentValue&&!e.isOpen?.previousValue&&(console.log("Modal opened, starting visualization..."),setTimeout(()=>{this.initializeCanvas(),this.startVisualization()},100)),e.isOpen&&!e.isOpen.currentValue&&this.animationId&&(console.log("Modal closed, stopping visualization..."),this.stopVisualization())}ngOnDestroy(){this.stopVisualization()}initializeCanvas(){if(!this.canvasRef?.nativeElement){console.warn("Canvas not available");return}let e=this.canvasRef.nativeElement;if(this.ctx=e.getContext("2d"),!this.ctx){console.error("Failed to get canvas context");return}let t=window.devicePixelRatio||1,i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t,this.ctx.scale(t,t),e.style.width=i.width+"px",e.style.height=i.height+"px",console.log("Canvas initialized:",e.width,"x",e.height),this.demoState.initialized=!0}nextPage(){console.log("Next page clicked. Current index:",this.currentPageIndex),this.currentPageIndex<this.pages.length-1&&(this.currentPageIndex++,console.log("Moving to page:",this.currentPageIndex+1),this.resetDemoState(),this.updateVisualization())}previousPage(){console.log("Previous page clicked. Current index:",this.currentPageIndex),this.currentPageIndex>0&&(this.currentPageIndex--,console.log("Moving to page:",this.currentPageIndex+1),this.resetDemoState(),this.updateVisualization())}close(){this.closeModal.emit()}onBackdropClick(e){this.close()}resetDemoState(){this.demoState.time=0,this.demoState.phase=0,this.demoState.queues=[2,1.5,2.5,1.8]}startVisualization(){if(!this.ctx||!this.demoState.initialized){console.warn("Cannot start visualization - canvas not ready");return}console.log("Starting visualization for page:",this.currentPageIndex+1),this.stopVisualization(),this.resetDemoState(),this.animateDemo()}stopVisualization(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}animateDemo(){if(!(!this.ctx||!this.demoState.initialized)){switch(this.demoState.time+=.05,this.currentPage.visualization){case"rl-demo":this.animateRLDemo();break;case"baseline-demo":this.animateBaselineDemo();break;case"comparison":this.animateComparisonDemo();break;default:this.animateOverview()}this.drawVisualization(),this.animationId=requestAnimationFrame(()=>this.animateDemo())}}animateOverview(){let e=[2,1.5,2.5,1.8];this.demoState.queues=e.map((t,i)=>Math.max(.5,t+Math.sin(this.demoState.time*.5+i)*.8)),this.demoState.phase=Math.floor(this.demoState.time/4)%2===0?0:1}animateRLDemo(){let e=this.demoState.time;this.demoState.queues[0]=Math.max(.5,3+Math.sin(e*.3)*1.5),this.demoState.queues[1]=Math.max(.5,1.5+Math.sin(e*.5)*1),this.demoState.queues[2]=Math.max(.5,2+Math.sin(e*.4)*1.2),this.demoState.queues[3]=Math.max(.5,3.5+Math.sin(e*.6)*2);let t=this.demoState.queues[0]+this.demoState.queues[2],i=this.demoState.queues[1]+this.demoState.queues[3];Math.floor(e/4)%2===0?this.demoState.phase=i>t?1:0:this.demoState.phase=t>i?0:1}animateBaselineDemo(){this.demoState.phase=Math.floor(this.demoState.time/4)%2===0?0:1;let t=this.demoState.time%8%4;this.demoState.phase===0?(this.demoState.queues[0]=Math.max(.5,1+Math.sin(t)*.5),this.demoState.queues[2]=Math.max(.5,1+Math.sin(t)*.5),this.demoState.queues[1]=Math.min(6,1+t*.8),this.demoState.queues[3]=Math.min(5,1+t*.7)):(this.demoState.queues[1]=Math.max(.5,1+Math.sin(t)*.5),this.demoState.queues[3]=Math.max(.5,1+Math.sin(t)*.5),this.demoState.queues[0]=Math.min(6,1+t*.8),this.demoState.queues[2]=Math.min(5,1+t*.7))}animateComparisonDemo(){this.demoState.time%10<5?(this.demoState.phase=0,this.demoState.queues=[1.5,3.5,1.2,4]):(this.demoState.phase=1,this.demoState.queues=[3,1.5,2.8,1])}updateVisualization(){this.resetDemoState(),this.ctx&&this.demoState.initialized&&this.drawVisualization()}drawVisualization(){if(!this.ctx)return;let e=300,t=300;this.ctx.fillStyle="#f8fafc",this.ctx.fillRect(0,0,e,t),this.drawDemoIntersection(e,t),this.drawPageSpecificOverlay(e,t)}drawDemoIntersection(e,t){if(!this.ctx)return;let i=e/2,n=t/2,r=80;this.ctx.fillStyle="#6b7280",this.ctx.fillRect(0,n-r/2,e,r),this.ctx.fillRect(i-r/2,0,r,t),this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=2,this.ctx.setLineDash([15,10]),this.ctx.beginPath(),this.ctx.moveTo(0,n),this.ctx.lineTo(e,n),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(i,0),this.ctx.lineTo(i,t),this.ctx.stroke(),this.ctx.setLineDash([]),this.drawDemoTrafficLights(e,t),this.drawDemoVehicleQueues(e,t),this.ctx.fillStyle="#e5e7eb",this.ctx.fillRect(i-30,n-30,60,60),this.ctx.strokeStyle="#9ca3af",this.ctx.lineWidth=2,this.ctx.strokeRect(i-30,n-30,60,60)}drawDemoTrafficLights(e,t){if(!this.ctx)return;let i=e/2,n=t/2,r=16,c=65;[{x:i,y:n-c,direction:"north"},{x:i+c,y:n,direction:"east"},{x:i,y:n+c,direction:"south"},{x:i-c,y:n,direction:"west"}].forEach(m=>{let x=this.isDirectionGreen(m.direction);this.ctx.fillStyle="#374151",this.ctx.fillRect(m.x-r/2,m.y-r/2,r,r),this.ctx.fillStyle=x?"#10b981":"#ef4444",this.ctx.beginPath(),this.ctx.arc(m.x,m.y,r/3,0,2*Math.PI),this.ctx.fill(),x&&(this.ctx.fillStyle="rgba(16, 185, 129, 0.3)",this.ctx.beginPath(),this.ctx.arc(m.x,m.y,r/2,0,2*Math.PI),this.ctx.fill())})}drawDemoVehicleQueues(e,t){if(!this.ctx)return;let i=e/2,n=t/2,r=6,c=8;[{queue:this.demoState.queues[0],startX:i-12,startY:n-80,dx:0,dy:-c,color:"#ef4444"},{queue:this.demoState.queues[1],startX:i+80,startY:n-12,dx:c,dy:0,color:"#3b82f6"},{queue:this.demoState.queues[2],startX:i+12,startY:n+80,dx:0,dy:c,color:"#10b981"},{queue:this.demoState.queues[3],startX:i-80,startY:n+12,dx:-c,dy:0,color:"#f59e0b"}].forEach(m=>{let x=Math.min(Math.floor(m.queue),10);for(let y=0;y<x;y++){let E=m.startX+m.dx*y,A=m.startY+m.dy*y;this.ctx.fillStyle=m.color,this.ctx.fillRect(E-r/2,A-r/2,r,r),this.ctx.strokeStyle="#1f2937",this.ctx.lineWidth=1,this.ctx.strokeRect(E-r/2,A-r/2,r,r)}this.ctx.fillStyle="#374151",this.ctx.font="12px Arial",this.ctx.textAlign="center",this.ctx.fillText(m.queue.toFixed(1),m.startX,m.startY-15)})}drawPageSpecificOverlay(e,t){if(this.ctx)switch(this.currentPage.visualization){case"rl-demo":this.drawRLOverlay(e,t);break;case"baseline-demo":this.drawBaselineOverlay(e,t);break;case"comparison":this.drawComparisonOverlay(e,t);break;case"overview":this.drawOverviewOverlay(e,t);break}}drawOverviewOverlay(e,t){this.ctx&&(this.ctx.fillStyle="#3b82f6",this.ctx.font="bold 14px Arial",this.ctx.textAlign="center",this.ctx.fillText("\u{1F6A6} 4-Way Intersection",e/2,25))}drawRLOverlay(e,t){this.ctx&&(this.ctx.fillStyle="rgba(59, 130, 246, 0.1)",this.ctx.fillRect(5,5,e-10,30),this.ctx.fillStyle="#3b82f6",this.ctx.font="bold 12px Arial",this.ctx.textAlign="center",this.ctx.fillText("\u{1F9E0} AI Learning & Adapting",e/2,22),this.ctx.font="10px Arial",this.ctx.fillText(`Decision: ${this.demoState.phase===0?"NS Green":"EW Green"}`,e/2,e-10))}drawBaselineOverlay(e,t){if(!this.ctx)return;let n=this.demoState.time%8%4/4;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(10,10,e-20,25),this.ctx.fillStyle="#ef4444",this.ctx.fillRect(15,15,(e-30)*n,15),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 10px Arial",this.ctx.textAlign="center",this.ctx.fillText("\u23F1\uFE0F Fixed 4s Timer",e/2,26)}drawComparisonOverlay(e,t){if(!this.ctx)return;this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,t-50,e-20,40);let i=this.demoState.queues.reduce((c,w)=>c+w,0),n=Math.floor(i*.7),r=Math.floor(i);this.ctx.fillStyle="#ffffff",this.ctx.font="10px Arial",this.ctx.textAlign="left",this.ctx.fillText(`\u{1F9E0} RL Score: -${n}`,15,t-35),this.ctx.fillText(`\u23F1\uFE0F Baseline: -${r}`,15,t-20),this.ctx.fillText(`Total Queue: ${i.toFixed(1)}`,15,t-5)}isDirectionGreen(e){switch(e){case"north":case"south":return this.demoState.phase===0;case"east":case"west":return this.demoState.phase===1;default:return!1}}getVisualizationLabel(){switch(this.currentPage.visualization){case"rl-demo":return"RL Agent Demo";case"baseline-demo":return"Fixed-Timer Demo";case"comparison":return"Performance Comparison";default:return"Traffic Overview"}}static \u0275fac=function(t){return new(t||d)};static \u0275cmp=M({type:d,selectors:[["app-documentation-modal"]],viewQuery:function(t,i){if(t&1&&I(ie,7),t&2){let n;L(n=P())&&(i.canvasRef=n.first)}},inputs:{isOpen:"isOpen"},outputs:{closeModal:"closeModal"},features:[W],decls:1,vars:1,consts:[["demoCanvas",""],["class","fixed inset-0 flex items-center justify-center backdrop-blur-sm","style","z-index: 9999; background-color: rgba(0, 0, 0, 0.5);",3,"click",4,"ngIf"],[1,"fixed","inset-0","flex","items-center","justify-center","backdrop-blur-sm",2,"z-index","9999","background-color","rgba(0, 0, 0, 0.5)",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","max-w-4xl","w-full","mx-4","max-h-[90vh]","overflow-hidden",2,"z-index","10000",3,"click"],[1,"bg-gradient-to-r","from-blue-600","to-purple-600","text-white","p-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold"],[1,"text-blue-100","mt-1"],[1,"text-white","hover:text-gray-200","text-2xl","font-bold","w-8","h-8","flex","items-center","justify-center","rounded-full","hover:bg-black","hover:bg-opacity-20",3,"click"],[1,"bg-gray-50","px-6","py-3"],[1,"flex","items-center","justify-between"],[1,"flex","space-x-2"],["class","w-3 h-3 rounded-full transition-colors duration-200",3,"ngClass",4,"ngFor","ngForOf"],[1,"text-sm","text-gray-600"],[1,"flex","h-[500px]"],[1,"w-1/2","p-6","flex","flex-col","justify-between"],[1,"text-xl","font-semibold","text-gray-800","mb-4"],[1,"text-gray-600","mb-4","leading-relaxed"],["class","space-y-2",4,"ngIf"],[1,"flex","justify-between","items-center","mt-6"],["variant","secondary","size","sm",3,"click","disabled"],["variant","secondary","size","sm",3,"click"],["size","sm",3,"click","variant"],[1,"w-1/2","bg-gray-50","p-6","flex","items-center","justify-center"],[1,"relative"],["width","300","height","300",1,"border-2","border-gray-300","rounded-lg","bg-white","shadow-sm",2,"width","300px","height","300px"],[1,"absolute","bottom-2","left-2","bg-black","bg-opacity-70","text-white","text-xs","px-2","py-1","rounded"],[1,"w-3","h-3","rounded-full","transition-colors","duration-200",3,"ngClass"],[1,"space-y-2"],["class","flex items-start text-sm text-gray-700",4,"ngFor","ngForOf"],[1,"flex","items-start","text-sm","text-gray-700"],[1,"text-blue-600","mr-2","mt-1"]],template:function(t,i){t&1&&S(0,re,39,10,"div",1),t&2&&u("ngIf",i.isOpen)},dependencies:[N,Q,Y,V,q],styles:[".modal-enter[_ngcontent-%COMP%]{opacity:0;transform:scale(.9)}.modal-enter-active[_ngcontent-%COMP%]{opacity:1;transform:scale(1);transition:opacity .3s,transform .3s}"]})};var oe=["simulationCanvas"];function le(d,e){if(d&1&&(s(0,"div",36)(1,"span",44),o(2,"Status:"),a(),s(3,"span",52),o(4),a()()),d&2){let t=g(2);l(4),b(t.getTrainingStatus())}}function ce(d,e){if(d&1&&(s(0,"div",42)(1,"h4",43),o(2,"\u{1F9E0} Training Progress"),a(),s(3,"div",36)(4,"span",44),o(5,"Episode Progress:"),a(),s(6,"div",45)(7,"div",46),C(8,"div",47),a(),s(9,"span",48),o(10),a()()(),s(11,"div",36)(12,"span",44),o(13,"Exploration (\u03B5):"),a(),s(14,"span",49),o(15),R(16,"number"),a()(),s(17,"div",36)(18,"span",44),o(19,"Memory Used:"),a(),s(20,"span",50),o(21),a()(),S(22,le,5,1,"div",51),a()),d&2){let t=g();l(8),F("width",t.currentStep/t.getEpisodeLength()*100,"%"),l(2),k("",t.currentStep,"/",t.getEpisodeLength()),l(5),b(T(16,7,t.epsilon,"1.3-3")),l(6),b(t.getMemoryUsage()),l(),u("ngIf",t.getTrainingStatus())}}var J=class d{constructor(e,t){this.rlService=e;this.baselineService=t}canvasRef;destroy$=new G;ctx=null;animationId=null;isRLRunning=!1;isBaselineRunning=!1;currentEpisode=0;currentStep=0;currentPhase=0;queueLengths=[0,0,0,0];showDocumentation=!1;arrivalRates=[.1,.08,.12,.09];learningRate=.001;gamma=.95;epsilon=1;rlMetrics={totalReward:0,avgQueueLength:0,totalVehicles:0,avgWaitTime:0,episode:0};baselineMetrics={totalReward:0,avgQueueLength:0,totalVehicles:0,avgWaitTime:0,episode:0};get avgQueueLength(){return this.queueLengths.reduce((e,t)=>e+t,0)/4}ngOnInit(){this.initializeCanvas(),this.initializeServices(),this.setupSubscriptions(),this.startAnimationLoop()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.animationId&&cancelAnimationFrame(this.animationId)}initializeCanvas(){let e=this.canvasRef.nativeElement;this.ctx=e.getContext("2d"),this.rlService.setCanvas(e),this.ctx&&this.drawIntersection()}initializeServices(){this.rlService.initialize(),console.log("Services initialized successfully")}setupSubscriptions(){this.rlService.state$.subscribe(e=>{this.currentPhase=e.currentPhase,this.queueLengths=e.queueLengths,this.currentStep=e.totalTime,this.drawIntersection()}),this.rlService.metrics$.subscribe(e=>{this.rlMetrics=e,this.currentEpisode=e.episode}),this.rlService.isRunning$.subscribe(e=>{this.isRLRunning=e,console.log("RL Running state changed to:",e)}),this.baselineService.state$.subscribe(e=>{this.isRLRunning||(this.currentPhase=e.currentPhase,this.queueLengths=e.queueLengths,this.currentStep=e.totalTime,this.drawIntersection())}),this.baselineService.metrics$.subscribe(e=>{this.baselineMetrics=e}),this.baselineService.isRunning$.subscribe(e=>{this.isBaselineRunning=e,console.log("Baseline Running state changed to:",e)})}startAnimationLoop(){let e=()=>{this.drawIntersection(),this.animationId=requestAnimationFrame(e)};e()}drawIntersection(){if(!this.ctx)return;let e=this.canvasRef.nativeElement,t=e.width,i=e.height;this.ctx.fillStyle="#f8fafc",this.ctx.fillRect(0,0,t,i),this.drawRoads(t,i),this.drawTrafficLights(t,i),this.drawVehicleQueues(t,i),this.drawIntersectionCenter(t,i)}drawRoads(e,t){if(!this.ctx)return;let i=100,n=e/2,r=t/2;this.ctx.fillStyle="#6b7280",this.ctx.fillRect(0,r-i/2,e,i),this.ctx.fillRect(n-i/2,0,i,t),this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=2,this.ctx.setLineDash([20,10]),this.ctx.beginPath(),this.ctx.moveTo(0,r),this.ctx.lineTo(e,r),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(n,0),this.ctx.lineTo(n,t),this.ctx.stroke(),this.ctx.setLineDash([])}drawTrafficLights(e,t){if(!this.ctx)return;let i=e/2,n=t/2,r=20,c=80;[{x:i,y:n-c,direction:"north"},{x:i+c,y:n,direction:"east"},{x:i,y:n+c,direction:"south"},{x:i-c,y:n,direction:"west"}].forEach(m=>{let x=this.isDirectionGreen(m.direction);this.ctx.fillStyle="#374151",this.ctx.fillRect(m.x-r/2,m.y-r/2,r,r),this.ctx.fillStyle=x?"#10b981":"#ef4444",this.ctx.beginPath(),this.ctx.arc(m.x,m.y,r/3,0,2*Math.PI),this.ctx.fill()})}drawVehicleQueues(e,t){if(!this.ctx)return;let i=e/2,n=t/2,r=8,c=12;[{queue:this.queueLengths[0],startX:i-15,startY:n-100,dx:0,dy:-c},{queue:this.queueLengths[1],startX:i+100,startY:n-15,dx:c,dy:0},{queue:this.queueLengths[2],startX:i+15,startY:n+100,dx:0,dy:c},{queue:this.queueLengths[3],startX:i-100,startY:n+15,dx:-c,dy:0}].forEach(m=>{for(let x=0;x<Math.min(m.queue,15);x++){let y=m.startX+m.dx*x,E=m.startY+m.dy*x;this.ctx.fillStyle="#3b82f6",this.ctx.fillRect(y-r/2,E-r/2,r,r),this.ctx.strokeStyle="#1e40af",this.ctx.lineWidth=1,this.ctx.strokeRect(y-r/2,E-r/2,r,r)}})}drawIntersectionCenter(e,t){if(!this.ctx)return;let i=e/2,n=t/2,r=50;this.ctx.fillStyle="#f3f4f6",this.ctx.fillRect(i-r/2,n-r/2,r,r),this.ctx.strokeStyle="#d1d5db",this.ctx.lineWidth=2,this.ctx.strokeRect(i-r/2,n-r/2,r,r)}onCanvasClick(e){let t=this.canvasRef.nativeElement.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top;console.log("Canvas clicked at:",i,n)}isToggling=!1;toggleRLSimulation(){if(this.isToggling){console.log("Toggle already in progress, ignoring...");return}this.isToggling=!0,console.log("Toggle RL - Current state:",this.isRLRunning);try{this.isRLRunning?(console.log("Stopping RL simulation..."),this.rlService.stopSimulation()):(console.log("Starting RL simulation..."),this.rlService.startSimulation())}finally{setTimeout(()=>{this.isToggling=!1},500)}}toggleBaselineSimulation(){if(this.isToggling){console.log("Toggle already in progress, ignoring...");return}this.isToggling=!0,console.log("Toggle Baseline - Current state:",this.isBaselineRunning);try{this.isBaselineRunning?(console.log("Stopping baseline simulation..."),this.baselineService.stopSimulation()):(console.log("Starting baseline simulation..."),this.baselineService.startSimulation())}finally{setTimeout(()=>{this.isToggling=!1},500)}}resetSimulation(){this.rlService.reset(),this.baselineService.reset(),this.currentEpisode=0,this.currentStep=0}saveModel(){this.rlService.saveModel().then(()=>{console.log("Model saved successfully")}).catch(e=>{console.error("Failed to save model:",e)})}loadModel(){this.rlService.loadModel().then(()=>{console.log("Model loaded successfully")}).catch(e=>{console.error("Failed to load model:",e)})}updateArrivalRate(e,t){this.arrivalRates[e]=t;let i=this.rlService.getConfig();i.arrivalRates[e]=t,this.rlService.updateConfig(i)}updateLearningRate(e){this.learningRate=e,this.rlService.updateDQNConfig({learningRate:e})}updateGamma(e){this.gamma=e,this.rlService.updateDQNConfig({gamma:e})}updateEpsilon(e){this.epsilon=e,this.rlService.updateDQNConfig({epsilon:e})}getTrafficLightClass(e){return this.isDirectionGreen(e)?"traffic-light-green":"traffic-light-red"}getPhaseColor(e){switch(e){case 0:return"text-green-600";case 1:return"text-blue-600";case 2:return"text-red-600";case 3:return"text-yellow-600";default:return"text-gray-600"}}getPhaseText(e){switch(e){case 0:return"North-South Green";case 1:return"East-West Green";case 2:return"All Red";case 3:return"Pedestrian Phase";default:return"Unknown"}}isDirectionGreen(e){switch(e){case"north":case"south":return this.currentPhase===0;case"east":case"west":return this.currentPhase===1;default:return!1}}openDocumentation(){console.log("Opening documentation modal..."),this.showDocumentation=!0,console.log("showDocumentation is now:",this.showDocumentation)}closeDocumentation(){console.log("Closing documentation modal..."),this.showDocumentation=!1,console.log("showDocumentation is now:",this.showDocumentation)}getEpisodeLength(){return this.rlService.getConfig().episodeLength}getMemoryUsage(){try{let e=this.rlService.getDQNMemoryStats();return`${e.size}/${e.capacity}`}catch{return"N/A"}}getTrainingStatus(){return this.isRLRunning?this.rlService.getCurrentEpsilon()>.1?"\u{1F50D} Exploring":"\u{1F3AF} Exploiting":""}getCurrentEpsilon(){try{return this.rlService.getCurrentEpsilon()}catch{return this.epsilon}}static \u0275fac=function(t){return new(t||d)(O(U),O(H))};static \u0275cmp=M({type:d,selectors:[["app-simulation"]],viewQuery:function(t,i){if(t&1&&I(oe,7),t&2){let n;L(n=P())&&(i.canvasRef=n.first)}},decls:105,vars:69,consts:[["simulationCanvas",""],[3,"closeModal","isOpen"],[1,"simulation-container","p-6","max-w-7xl","mx-auto"],[1,"header","mb-8"],[1,"flex","justify-between","items-center"],[1,"text-3xl","font-bold","text-gray-900","mb-2"],[1,"text-lg","text-gray-600"],["variant","secondary","size","sm",3,"click"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-2"],[1,"bg-white","rounded-lg","shadow-md","p-6"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-semibold","text-gray-800"],[1,"flex","space-x-2"],[1,"text-sm","text-gray-500"],["width","600","height","600",1,"intersection-canvas","w-full",3,"click"],[1,"mt-4","grid","grid-cols-4","gap-4","text-center"],[1,"traffic-light-status"],[1,"text-sm","font-medium"],[1,"text-xs"],[1,"space-y-6"],[1,"text-lg","font-semibold","text-gray-800","mb-4"],[1,"space-y-4"],[3,"click","variant","fullWidth"],["variant","secondary",3,"click","fullWidth"],[1,"grid","grid-cols-2","gap-2"],["size","sm","variant","success",3,"click","fullWidth","disabled"],["size","sm","variant","secondary",3,"click","fullWidth"],["label","North Arrival Rate","unit"," veh/s","description","Vehicles per second from north",3,"valueChange","min","max","step","value"],["label","East Arrival Rate","unit"," veh/s","description","Vehicles per second from east",3,"valueChange","min","max","step","value"],["label","South Arrival Rate","unit"," veh/s","description","Vehicles per second from south",3,"valueChange","min","max","step","value"],["label","West Arrival Rate","unit"," veh/s","description","Vehicles per second from west",3,"valueChange","min","max","step","value"],["label","Learning Rate","description","How fast the agent learns",3,"valueChange","min","max","step","value"],["label","Discount Factor (\u03B3)","description","Future reward importance",3,"valueChange","min","max","step","value"],["label","Exploration (\u03B5)","description","Random action probability",3,"valueChange","min","max","step","value"],[1,"space-y-3"],[1,"metric-row"],[1,"text-sm","text-gray-600"],[1,"text-sm","font-mono","text-blue-600"],[1,"text-sm","font-mono","text-red-600"],[1,"text-sm","font-mono","text-gray-800"],["class","mt-4 pt-4 border-t border-gray-200",4,"ngIf"],[1,"mt-4","pt-4","border-t","border-gray-200"],[1,"text-sm","font-semibold","text-gray-700","mb-2"],[1,"text-xs","text-gray-600"],[1,"flex","items-center","space-x-2"],[1,"w-20","bg-gray-200","rounded-full","h-2"],[1,"bg-blue-600","h-2","rounded-full","transition-all","duration-300"],[1,"text-xs","font-mono"],[1,"text-xs","font-mono","text-orange-600"],[1,"text-xs","font-mono","text-purple-600"],["class","metric-row",4,"ngIf"],[1,"text-xs","font-mono","text-green-600"]],template:function(t,i){if(t&1){let n=D();s(0,"app-documentation-modal",1),f("closeModal",function(){return h(n),p(i.closeDocumentation())}),a(),s(1,"div",2)(2,"div",3)(3,"div",4)(4,"div")(5,"h1",5),o(6,"Traffic Simulation"),a(),s(7,"p",6),o(8,"Compare RL Agent (DQN) vs Fixed-Timer Baseline"),a()(),s(9,"app-button",7),f("click",function(){return h(n),p(i.openDocumentation())}),o(10," \u{1F4D6} How it Works "),a()()(),s(11,"div",8)(12,"div",9)(13,"div",10)(14,"div",11)(15,"h2",12),o(16,"4-Way Intersection"),a(),s(17,"div",13)(18,"span",14),o(19),a(),s(20,"span",14),o(21),a()()(),s(22,"canvas",15,0),f("click",function(c){return h(n),p(i.onCanvasClick(c))}),a(),s(24,"div",16)(25,"div",17)(26,"div",18),o(27,"North"),a(),s(28,"div",19),o(29),a()(),s(30,"div",17)(31,"div",18),o(32,"East"),a(),s(33,"div",19),o(34),a()(),s(35,"div",17)(36,"div",18),o(37,"South"),a(),s(38,"div",19),o(39),a()(),s(40,"div",17)(41,"div",18),o(42,"West"),a(),s(43,"div",19),o(44),a()()()()(),s(45,"div",20)(46,"div",10)(47,"h3",21),o(48,"Simulation Controls"),a(),s(49,"div",22)(50,"div",13)(51,"app-button",23),f("click",function(){return h(n),p(i.toggleRLSimulation())}),o(52),a(),s(53,"app-button",23),f("click",function(){return h(n),p(i.toggleBaselineSimulation())}),o(54),a()(),s(55,"app-button",24),f("click",function(){return h(n),p(i.resetSimulation())}),o(56," Reset All "),a(),s(57,"div",25)(58,"app-button",26),f("click",function(){return h(n),p(i.saveModel())}),o(59," Save Model "),a(),s(60,"app-button",27),f("click",function(){return h(n),p(i.loadModel())}),o(61," Load Model "),a()()()(),s(62,"div",10)(63,"h3",21),o(64,"Traffic Parameters"),a(),s(65,"div",22)(66,"app-slider",28),f("valueChange",function(c){return h(n),p(i.updateArrivalRate(0,c))}),a(),s(67,"app-slider",29),f("valueChange",function(c){return h(n),p(i.updateArrivalRate(1,c))}),a(),s(68,"app-slider",30),f("valueChange",function(c){return h(n),p(i.updateArrivalRate(2,c))}),a(),s(69,"app-slider",31),f("valueChange",function(c){return h(n),p(i.updateArrivalRate(3,c))}),a()()(),s(70,"div",10)(71,"h3",21),o(72,"RL Parameters"),a(),s(73,"div",22)(74,"app-slider",32),f("valueChange",function(c){return h(n),p(i.updateLearningRate(c))}),a(),s(75,"app-slider",33),f("valueChange",function(c){return h(n),p(i.updateGamma(c))}),a(),s(76,"app-slider",34),f("valueChange",function(c){return h(n),p(i.updateEpsilon(c))}),a()()(),s(77,"div",10)(78,"h3",21),o(79,"Live Metrics"),a(),s(80,"div",35)(81,"div",36)(82,"span",37),o(83,"RL Total Reward:"),a(),s(84,"span",38),o(85),R(86,"number"),a()(),s(87,"div",36)(88,"span",37),o(89,"Baseline Total Reward:"),a(),s(90,"span",39),o(91),R(92,"number"),a()(),s(93,"div",36)(94,"span",37),o(95,"Avg Queue Length:"),a(),s(96,"span",40),o(97),R(98,"number"),a()(),s(99,"div",36)(100,"span",37),o(101,"Current Phase:"),a(),s(102,"span",18),o(103),a()(),S(104,ce,23,10,"div",41),a()()()()()}t&2&&(u("isOpen",i.showDocumentation),l(19),v("Episode: ",i.currentEpisode),l(2),v("Step: ",i.currentStep),l(4),_(i.getTrafficLightClass("north")),l(4),v("",i.queueLengths[0]," vehicles"),l(),_(i.getTrafficLightClass("east")),l(4),v("",i.queueLengths[1]," vehicles"),l(),_(i.getTrafficLightClass("south")),l(4),v("",i.queueLengths[2]," vehicles"),l(),_(i.getTrafficLightClass("west")),l(4),v("",i.queueLengths[3]," vehicles"),l(7),u("variant",i.isRLRunning?"danger":"primary")("fullWidth",!0),l(),v(" ",i.isRLRunning?"Stop RL":"Start RL"," "),l(),u("variant",i.isBaselineRunning?"danger":"secondary")("fullWidth",!0),l(),v(" ",i.isBaselineRunning?"Stop Baseline":"Start Baseline"," "),l(),u("fullWidth",!0),l(3),u("fullWidth",!0)("disabled",!i.isRLRunning),l(2),u("fullWidth",!0),l(6),u("min",0)("max",.5)("step",.01)("value",i.arrivalRates[0]),l(),u("min",0)("max",.5)("step",.01)("value",i.arrivalRates[1]),l(),u("min",0)("max",.5)("step",.01)("value",i.arrivalRates[2]),l(),u("min",0)("max",.5)("step",.01)("value",i.arrivalRates[3]),l(5),u("min",1e-4)("max",.01)("step",1e-4)("value",i.learningRate),l(),u("min",.8)("max",.999)("step",.001)("value",i.gamma),l(),u("min",.01)("max",1)("step",.01)("value",i.epsilon),l(9),b(T(86,60,i.rlMetrics.totalReward,"1.2-2")),l(6),b(T(92,63,i.baselineMetrics.totalReward,"1.2-2")),l(6),b(T(98,66,i.avgQueueLength,"1.1-1")),l(5),_(i.getPhaseColor(i.currentPhase)),l(),b(i.getPhaseText(i.currentPhase)),l(),u("ngIf",i.isRLRunning))},dependencies:[N,V,X,j,q,$,z],encapsulation:2})};export{J as SimulationComponent};
